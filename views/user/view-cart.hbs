<!-- Shoping Cart -->
{{#if products}}
<form class="bg0 p-t-75 p-b-85" id="reload-section">
	<div class="container">
		<div class="row">
			<div class="col-lg-10 col-xl-7 m-lr-auto m-b-50">
				<div class="m-l-25 m-r--38 m-lr-0-xl">

					<div class="wrap-table-shopping-cart">

						<table class="table-shopping-cart">

							<tr class="table_head">
								<th class="column-1">Product</th>
								<th class="column-2"></th>
								<th class="column-3">Price</th>
								<th class="column-4">Quantity</th>
								

							</tr>
							{{#each products}}

							<tr class="table_row">
								<td class="column-1">
									<div class="how-itemcart1">
										<img src="product-image/{{this.product.images.[0]}}" alt="IMG">
									</div>
								</td>
								<td class="column-2">{{this.product.name}}</td>

								<td class="column-3">RS: <span id="t{{this.product._id}}">{{ this.sum }}</span></td>
								<td class="column-4">
									<div>


										<button type="button" class="btn btn-light"
											onclick="changeQuantity('{{this._id}}','{{this.product._id}}','{{../user._id}}',-1)">-</button><span
											id="{{this.product._id}}"> {{this.quantity}} </span><button type="button"
											class="btn btn-light"
											onclick="changeQuantity('{{this._id}}','{{this.product._id}}','{{../user._id}}',1)">+</button>


									</div>

								</td>
								<td>
									<a href="javascript:void(0)" class="btn btn-danger"
										onclick="remove('{{this._id}}','{{this.product._id}}')">remove
									</a>
								</td>

							</tr>
							{{/each}}




						</table>
					</div>


					<div class="flex-w flex-sb-m bor15 p-t-18 p-b-15 p-lr-40 p-lr-15-sm">

					</div>
				</div>
			</div>

			<div class="col-sm-10 col-lg-7 col-xl-5 m-lr-auto m-b-50">
				<div class="bor10 p-lr-40 p-t-30 p-b-40 m-l-63 m-r-40 m-lr-0-xl p-lr-15-sm">

					<div class="flex-w flex-t p-t-27 p-b-33">
						<div class="size-208">
							<span class="mtext-101 cl2">
								Products:
							</span>
						</div>

						<div class="size-209 p-t-1">
							<span class="mtext-110 cl2">
								{{cartCount}}
							</span>
						</div>
					</div>
					<div class="flex-w flex-t bor12 p-b-13">
						<div class="size-208">
							<span class="stext-110 cl2">
								Subtotal: â‚¹
							</span>
						</div>

						<div class="size-209">
							<span class="mtext-110 cl2" id="total">
								{{totalValue}}
							</span>
						</div>
					</div>




					<a href="/place-order" class="btn btn-success mt-3" style="width: 100%;"><b>Checkout</b></a>


				</div>
			</div>
		</div>
	</div>
</form>




<!-- Footer -->
<footer class="bg3 p-t-75 p-b-32">
	<div class="container">
		<div class="row">
			<div class="col-sm-6 col-lg-3 p-b-50">
				<h4 class="stext-301 cl0 p-b-30">
					Categories
				</h4>

				<ul>
					<li class="p-b-10">
						<a href="#" class="stext-107 cl7 hov-cl1 trans-04">
							Women
						</a>
					</li>

					<li class="p-b-10">
						<a href="#" class="stext-107 cl7 hov-cl1 trans-04">
							Men
						</a>
					</li>

					<li class="p-b-10">
						<a href="#" class="stext-107 cl7 hov-cl1 trans-04">
							Shoes
						</a>
					</li>

					<li class="p-b-10">
						<a href="#" class="stext-107 cl7 hov-cl1 trans-04">
							Watches
						</a>
					</li>
				</ul>
			</div>

			<div class="col-sm-6 col-lg-3 p-b-50">
				<h4 class="stext-301 cl0 p-b-30">
					Help
				</h4>

				<ul>
					<li class="p-b-10">
						<a href="#" class="stext-107 cl7 hov-cl1 trans-04">
							Track Order
						</a>
					</li>

					<li class="p-b-10">
						<a href="#" class="stext-107 cl7 hov-cl1 trans-04">
							Returns
						</a>
					</li>

					<li class="p-b-10">
						<a href="#" class="stext-107 cl7 hov-cl1 trans-04">
							Shipping
						</a>
					</li>

					<li class="p-b-10">
						<a href="#" class="stext-107 cl7 hov-cl1 trans-04">
							FAQs
						</a>
					</li>
				</ul>
			</div>

			<div class="col-sm-6 col-lg-3 p-b-50">
				<h4 class="stext-301 cl0 p-b-30">
					GET IN TOUCH
				</h4>

				<p class="stext-107 cl7 size-201">
					Any questions? Let us know in store at 8th floor, 379 Hudson St, New York, NY 10018 or call us on
					(+1) 96 716 6879
				</p>

				<div class="p-t-27">
					<a href="#" class="fs-18 cl7 hov-cl1 trans-04 m-r-16">
						<i class="fa fa-facebook"></i>
					</a>

					<a href="#" class="fs-18 cl7 hov-cl1 trans-04 m-r-16">
						<i class="fa fa-instagram"></i>
					</a>

					<a href="#" class="fs-18 cl7 hov-cl1 trans-04 m-r-16">
						<i class="fa fa-pinterest-p"></i>
					</a>
				</div>
			</div>

			<div class="col-sm-6 col-lg-3 p-b-50">
				<h4 class="stext-301 cl0 p-b-30">
					Newsletter
				</h4>

				<form>
					<div class="wrap-input1 w-full p-b-4">
						<input class="input1 bg-none plh1 stext-107 cl7" type="text" name="email"
							placeholder="email@example.com">
						<div class="focus-input1 trans-04"></div>
					</div>

					<div class="p-t-18">
						<button class="flex-c-m stext-101 cl0 size-103 bg1 bor1 hov-btn2 p-lr-15 trans-04">
							Subscribe
						</button>
					</div>
				</form>
			</div>
		</div>

		<div class="p-t-40">
			<div class="flex-c-m flex-w p-b-18">
				<a href="#" class="m-all-1">
					<img src="images/icons/icon-pay-01.png" alt="ICON-PAY">
				</a>

				<a href="#" class="m-all-1">
					<img src="images/icons/icon-pay-02.png" alt="ICON-PAY">
				</a>

				<a href="#" class="m-all-1">
					<img src="images/icons/icon-pay-03.png" alt="ICON-PAY">
				</a>

				<a href="#" class="m-all-1">
					<img src="images/icons/icon-pay-04.png" alt="ICON-PAY">
				</a>

				<a href="#" class="m-all-1">
					<img src="images/icons/icon-pay-05.png" alt="ICON-PAY">
				</a>
			</div>

			<p class="stext-107 cl6 txt-center">
				<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
				Copyright &copy;
				<script>document.write(new Date().getFullYear());</script> All rights reserved | Made with <i
					class="fa fa-heart-o" aria-hidden="true"></i> by <a href="https://colorlib.com"
					target="_blank">Colorlib</a> &amp; distributed by <a href="https://themewagon.com"
					target="_blank">ThemeWagon</a>
				<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->

			</p>
		</div>
	</div>
</footer>


<!-- Back to top -->
<div class="btn-back-to-top" id="myBtn">
	<span class="symbol-btn-back-to-top">
		<i class="zmdi zmdi-chevron-up"></i>
	</span>
</div>

<script>

	function changeQuantity(cartId, proId, userId, count) {
		let quantity = parseInt(document.getElementById(proId).innerHTML)
		console.log("qty", quantity)
		count = parseInt(count)
		$.ajax({
			url: '/change-product-quantity',
			data: {
				user: userId,
				cart: cartId,
				product: proId,
				count: count,
				quantity: quantity
			},
			method: 'post',
			success: (response) => {
				if (response.removeProduct) {
					alert('removed from cart')
					 $("#reload-section").load(location.href+" #reload-section")
				} else {
					console.log("qty", quantity)
					document.getElementById(proId).innerHTML = quantity + count
					document.getElementById("total").innerHTML = response.total
					$("#t"+proId).load(location.href + " #t"+proId);


				}
			}
		})

	}


</script>

<script>
	function remove(cartId, productId) {
    
        $.ajax({
            url: '/removeProductFromCart',
            data: {
                cartId: cartId,
                productId: productId
            },
            method: 'post',
            success: (response) => {

                if (response.productRemoved) {

                    alert('Do you really want to remove?')
                      $("#reload-section").load(location.href+" #reload-section")
                }
                else {
                    alert('false')
                }
            },
            error: (response) => {
                alert('err')
            }
        })
    }
</script>

{{else}}
<div class="container">

	<div class="col-sm-12 empty-cart-cls text-center mb-5 " style="margin-top:200px ;">
		<img src="https://cdn-icons-png.flaticon.com/512/678/678451.png" width="130" height="130"
			class="img-fluid mb-5 mr-3">
		<h3 class="mb-5"><strong>Your Cart is Empty</strong></h3>
		<button type="button" class="btn btn-outline-secondary">
			<a href="/" class="btn btn-index ">Shop now </a>
		</button>

	</div>

	{{/if}}